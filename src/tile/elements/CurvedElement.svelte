<script>
    // Licensed under GNU Public License version 3
    // Copyright (c) 2022 Jean-SÃ©bastien CONAN

    import { Vector2D } from '../../core/models';
    import { arcTo, attributeList, enlargeArc, lineTo, moveTo, RIGHT_ANGLE } from '../../core/helpers';

    export let cx = 0;
    export let cy = 0;
    export let width = 1;
    export let radius = 1;
    export let angle = 1;
    export let start = 0;
    export let d = 0;
    export let fill = void 0;
    export let stroke = void 0;
    export let transform = void 0;

    /**
     * Builds the SVG path for rendering a curve.
     * @param {number} curveRadius - The radius of the inner curve.
     * @param {number} curveWidth - The width between the inner and the outer curve.
     * @param {number} curveAngle - Tha angle of the curve.
     * @param {number} startAngle - The start angle of the curve.
     * @param {number} centerX - The X-coordinate of the center of the curve.
     * @param {number} centerY - The Y-coordinate of the center of the curve.
     * @param {number} addition - An additional distance added to the outline.
     * @private
     */
    function curvedElementPath(curveRadius, curveWidth, curveAngle, startAngle, centerX, centerY, addition) {
        addition = Math.min(addition, curveRadius);

        const center = new Vector2D(centerX, centerY);

        let innerRadius, innerAngle, innerCenter;

        if (curveAngle === RIGHT_ANGLE) {
            innerRadius = curveRadius;
            innerAngle = curveAngle;
            innerCenter = center.subScalar(addition);
        } else {
            innerRadius = curveRadius - addition;
            innerAngle = enlargeArc(curveAngle, innerRadius, addition * 2);
            innerCenter = center;
        }

        const innerStart = startAngle + (curveAngle - innerAngle) / 2;
        const innerEnd = innerStart + innerAngle;

        const outerRadius = curveRadius + curveWidth + addition;
        const outerAngle = enlargeArc(curveAngle, outerRadius, addition * 2);
        const outerStart = startAngle + (curveAngle - outerAngle) / 2;
        const outerEnd = outerStart + outerAngle;
        const outerCenter = center;

        const p1 = Vector2D.polar(innerRadius, innerStart, innerCenter);
        const p2 = Vector2D.polar(innerRadius, innerEnd, innerCenter);
        const p3 = Vector2D.polar(outerRadius, outerEnd, outerCenter);
        const p4 = Vector2D.polar(outerRadius, outerStart, outerCenter);

        return `${moveTo(p1)} ${arcTo(innerRadius, p2, 0, 1, 0)} ${lineTo(p3)} ${arcTo(outerRadius, p4, 0, 0, 0)} Z`;
    }
</script>

<path
    d={curvedElementPath(radius, width, angle, start, cx, cy, d)}
    {...attributeList(fill, 'fill')}
    {...attributeList(stroke, 'stroke')}
    {transform}
/>
